import{_ as P,u as F,k as R,j as S,c as i,a as t,t as l,g as r,F as T,n as j,p as b,w as V,A as m,b as k,h as x,i as f,B,o as c}from"./index-8f89c4fe.js";import{u as U}from"./useTheme-de86cb1f.js";const q=["data-theme"],G={class:"top-bar"},H={class:"nav-btns"},J=["disabled"],K={class:"nav-icon"},O={class:"nav-icon"},Q={class:"nav-icon"},W={class:"home-main content"},X={key:0,class:"list-state"},Y={key:1,class:"list-state list-state-error"},Z={key:2,class:"list posts-list"},tt=["onClick"],et={class:"post-header"},st=["src","alt"],at={class:"post-info"},nt={class:"author-name"},lt={class:"post-time"},ot={key:0,class:"post-tag"},it={class:"item-title"},ct={class:"item-desc"},ut={key:0,class:"post-media-thumb"},dt=["src","alt"],rt={key:1,class:"thumb-video"},_t={class:"post-footer"},mt=["disabled","onClick"],vt={class:"action-btn",disabled:""},ht={class:"modal-content"},kt={class:"modal-header"},ft=["src","alt"],bt={class:"post-info"},pt={class:"author-name"},yt={class:"post-time"},gt={class:"modal-title"},Ct={class:"modal-desc"},wt={key:0,class:"modal-media"},Mt=["src","alt"],$t=["src"],At={class:"modal-footer"},Tt=["disabled"],Vt={class:"action-btn static"},Bt={__name:"CommunityView",setup(Dt){const p=x(),{isAuthenticated:_,logout:D}=F(),{theme:y,toggleTheme:g}=U(),I=R(()=>y.value==="dark"?"â˜€ï¸":"ğŸŒ™"),v=f([]),h=f(!1),d=f(null),s=f(null),C=n=>`https://ui-avatars.com/api/?name=${encodeURIComponent(n||"åŒ¿å")}&background=random`;function L(n,e=60){return n?n.length<=e?n:n.slice(0,e)+"â€¦":""}function w(n){if(!n)return"";const e=new Date(n),u=(new Date-e)/1e3;return u<60?"åˆšåˆš":u<3600?`${Math.floor(u/60)} åˆ†é’Ÿå‰`:u<86400?`${Math.floor(u/3600)} å°æ—¶å‰`:u<604800?`${Math.floor(u/86400)} å¤©å‰`:e.toLocaleDateString("zh-CN")}async function M(){var n;h.value=!0,d.value=null;try{const e=await B.list({page:1,limit:30});e!=null&&e.success&&((n=e==null?void 0:e.data)!=null&&n.list)?v.value=(e.data.list||[]).map(a=>({...a,_liked:!1})):(v.value=[],d.value="åŠ è½½å¸–å­åˆ—è¡¨å¤±è´¥")}catch(e){v.value=[],d.value=(e==null?void 0:e.message)||(e==null?void 0:e.error)||"ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•"}finally{h.value=!1}}function N(n){s.value=n}function $(){s.value=null}async function A(n){var u;if(!_.value)return;const e=n.likes_count??n.likes??0,a=n._liked;n._liked=!0,n.likes_count=e+1,s.value&&s.value.id===n.id&&(s.value._liked=!0,s.value.likes_count=n.likes_count);try{const o=await B.like(n.id);if(o!=null&&o.success&&((u=o==null?void 0:o.data)==null?void 0:u.likes_count)!=null)n.likes_count=o.data.likes_count,s.value&&s.value.id===n.id&&(s.value.likes_count=o.data.likes_count);else throw new Error("ç‚¹èµå¤±è´¥")}catch(o){n._liked=a,n.likes_count=e,s.value&&s.value.id===n.id&&(s.value._liked=a,s.value.likes_count=e),d.value=(o==null?void 0:o.message)||(o==null?void 0:o.error)||"ç‚¹èµå¤±è´¥ï¼Œè¯·é‡è¯•",setTimeout(()=>{d.value=null},2e3)}}function z(){p.push("/editor")}function E(){_.value?confirm("ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ")&&D():p.push("/login")}return S(()=>{M()}),(n,e)=>(c(),i("div",{class:"community-container","data-theme":r(y)},[t("header",G,[e[4]||(e[4]=t("div",{class:"logo"},[t("span",{class:"logo-icon"},"ğŸ’¬"),t("span",null,"åˆ›ä½œç¤¾åŒº")],-1)),t("div",H,[t("button",{class:"btn",onClick:z},[...e[2]||(e[2]=[t("span",{class:"nav-icon"},"âœï¸",-1),t("span",null,"å»ç¼–è¾‘",-1)])]),t("button",{class:"btn refresh-btn",disabled:h.value,onClick:M},[t("span",K,l(h.value?"â³":"ğŸ”„"),1),e[3]||(e[3]=t("span",null,"åˆ·æ–°",-1))],8,J),t("button",{class:"btn login-btn",onClick:E},[t("span",O,l(r(_)?"ğŸšª":"ğŸ‘¤"),1),t("span",null,l(r(_)?"ç™»å‡º":"ç™»å½•"),1)]),t("button",{class:"btn theme-btn",onClick:e[0]||(e[0]=(...a)=>r(g)&&r(g)(...a))},[t("span",Q,l(I.value),1)])])]),t("main",W,[e[10]||(e[10]=t("section",{class:"home-banner header"},[t("h1",{class:"header-title"},"åˆ›ä½œè€…äº¤æµç¤¾åŒº"),t("p",null,"çŸ­å¸–ä¿¡æ¯æµï¼Œæ”¯æŒå›¾ç‰‡ä¸è§†é¢‘ã€‚ç‚¹å‡»å¡ç‰‡æŸ¥çœ‹è¯¦æƒ…ï¼Œç™»å½•åå¯ç‚¹èµäº’åŠ¨ã€‚")],-1)),h.value&&!v.value.length?(c(),i("div",X,"åŠ è½½ä¸­â€¦")):d.value?(c(),i("div",Y,l(d.value),1)):(c(),i("div",Z,[(c(!0),i(T,null,j(v.value,a=>(c(),i("div",{key:a.id,class:"list-item post-card",onClick:u=>N(a)},[t("div",et,[t("img",{src:a.author_avatar||C(a.author_name),alt:a.author_name,class:"avatar"},null,8,st),t("div",at,[t("span",nt,l(a.author_name||"åŒ¿å"),1),t("span",lt,l(w(a.created_at)),1)]),a.media_type?(c(),i("span",ot,l(a.media_type==="video"?"è§†é¢‘":"å›¾ç‰‡"),1)):m("",!0)]),t("h3",it,l(a.title),1),t("p",ct,l(L(a.content)),1),a.media_url?(c(),i("div",ut,[a.media_type==="image"?(c(),i("img",{key:0,src:a.media_url,alt:a.title,class:"thumb-img",loading:"lazy"},null,8,dt)):a.media_type==="video"?(c(),i("div",rt,[...e[5]||(e[5]=[t("span",{class:"thumb-video-icon"},"â–¶",-1),k(" è§†é¢‘ ",-1)])])):m("",!0)])):m("",!0),t("div",_t,[t("button",{class:b(["action-btn",{liked:a._liked}]),disabled:!r(_),onClick:V(u=>A(a),["stop"])},[e[6]||(e[6]=t("span",{class:"action-icon"},"â¤ï¸",-1)),k(" "+l(a.likes_count??a.likes),1)],10,mt),t("button",vt,[e[7]||(e[7]=t("span",{class:"action-icon"},"ğŸ’¬",-1)),k(" "+l(a.comments_count??a.comments??0),1)])])],8,tt))),128))])),t("div",{class:b(["modal",{"modal-visible":s.value}]),onClick:V($,["self"])},[t("div",ht,[t("span",{class:"close-btn",onClick:$},"Ã—"),s.value?(c(),i(T,{key:0},[t("div",kt,[t("img",{src:s.value.author_avatar||C(s.value.author_name),alt:s.value.author_name,class:"avatar"},null,8,ft),t("div",bt,[t("span",pt,l(s.value.author_name||"åŒ¿å"),1),t("span",yt,l(w(s.value.created_at)),1)])]),t("h2",gt,l(s.value.title),1),t("p",Ct,l(s.value.content),1),s.value.media_url?(c(),i("div",wt,[s.value.media_type==="image"?(c(),i("img",{key:0,src:s.value.media_url,alt:s.value.title,class:"modal-media-img"},null,8,Mt)):s.value.media_type==="video"?(c(),i("video",{key:1,src:s.value.media_url,controls:"",class:"modal-media-video"},null,8,$t)):m("",!0)])):m("",!0),t("div",At,[t("button",{class:b(["action-btn",{liked:s.value._liked}]),disabled:!r(_),onClick:e[1]||(e[1]=a=>A(s.value))},[e[8]||(e[8]=t("span",{class:"action-icon"},"â¤ï¸",-1)),k(" "+l(s.value.likes_count??s.value.likes),1)],10,Tt),t("span",Vt,[e[9]||(e[9]=t("span",{class:"action-icon"},"ğŸ’¬",-1)),k(" "+l(s.value.comments_count??s.value.comments??0)+" è¯„è®º ",1)])])],64)):m("",!0)])],2)]),e[11]||(e[11]=t("footer",{class:"home-footer"},[t("p",null,"Â© 2025 è½»é‡ç¼–è¾‘å™¨ - ç¤¾åŒºäº¤æµï¼Œçµæ„Ÿç¢°æ’")],-1))],8,q))}},Nt=P(Bt,[["__scopeId","data-v-cf69776a"]]);export{Nt as default};
